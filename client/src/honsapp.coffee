
self = module.exports

# Dependencies
Sidebar = require 'controllers/sidebar'
Display = require 'controllers/display'

dataloader = require 'dataloader'
hashpath = require 'hashpath'

# Test data
testdata = [{"id":1,"channel":"milkfat","title":"milkfat","live_title":"44/76 If we raise 9001 dollars Milkfat will wear his bloodseeker costume!   www.clanmilk.com","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_milkfat-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/milkfat-profile_image-96cd2eaf40ad1e72-150x150.jpeg","live":1,"viewers":4026,"embed_viewers":305,"embed_enabled":1,"featured":1,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-27T19:12:40.000Z","updated_at":"2012-01-28T15:51:09.000Z"},{"id":2,"channel":"shamsz","title":"Shamsz Heroes of Newerth 2000 MMR ","live_title":"How to Solo to 1800 with Shamsz.","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_shamsz-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/shamsz-profile_image-5143217d1a1bc987-150x150.png","live":1,"viewers":383,"embed_viewers":31,"embed_enabled":1,"featured":1,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-27T19:12:40.000Z","updated_at":"2012-01-28T15:51:09.000Z"},{"id":6,"channel":"raawrrisch","title":"raawrrisch","live_title":"Milkfat's Army - Baconmonkey Chill times","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_raawrrisch-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/raawrrisch-profile_image-06452605f2930a9e-150x150.jpeg","live":1,"viewers":3,"embed_viewers":1,"embed_enabled":1,"featured":1,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-27T19:12:40.000Z","updated_at":"2012-01-28T15:51:10.000Z"},{"id":11,"channel":"cptstronk","title":"cptstronk","live_title":"Fredrlk back to HoN 90% win smurf 6 kdr , webcam   [1080p] BIG MUSIC","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_cptstronk-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/cptstronk-profile_image-d61d9cd01c01c759-150x150.jpeg","live":1,"viewers":16,"embed_viewers":0,"embed_enabled":1,"featured":0,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-27T19:12:40.000Z","updated_at":"2012-01-28T15:51:10.000Z"},{"id":18,"channel":"fragilesnake","title":"fragilesnake","live_title":"Playing some HoN around 1700 mmr","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_fragilesnake-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/fragilesnake-profile_image-01b1685bcca5d801-150x150.png","live":1,"viewers":1,"embed_viewers":0,"embed_enabled":1,"featured":0,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-27T19:12:40.000Z","updated_at":"2012-01-28T15:51:10.000Z"},{"id":40,"channel":"h4nn1","title":"H4nn1","live_title":"SoloQing","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_h4nn1-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/h4nn1-profile_image-621df84b854e1456-150x150.jpeg","live":1,"viewers":445,"embed_viewers":81,"embed_enabled":1,"featured":1,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-28T15:51:09.000Z","updated_at":"2012-01-28T15:51:09.000Z"},{"id":41,"channel":"reservjesuz","title":"ReservJesuz [HD] Stream","live_title":"[720p] HoN /w Jesuz | TMM! Biiiiiiig Playys","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_reservjesuz-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/reservjesuz-profile_image-91d40d37f7fde4e4-150x150.jpeg","live":1,"viewers":30,"embed_viewers":5,"embed_enabled":1,"featured":1,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-28T15:51:09.000Z","updated_at":"2012-01-28T15:51:09.000Z"},{"id":42,"channel":"architiger626","title":"architiger626","live_title":"ArchiTigeR Tmm time 100% win with some friends? English aswell!. With Viewers later.","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_architiger626-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/architiger626-profile_image-525f669a9973f0b9-150x150.jpeg","live":1,"viewers":9,"embed_viewers":4,"embed_enabled":1,"featured":1,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-28T15:51:10.000Z","updated_at":"2012-01-28T15:51:10.000Z"},{"id":43,"channel":"haxxeren","title":"haxxeren","live_title":"Itsgosu | Haxxeren : TMM","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_haxxeren-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/haxxeren-profile_image-170d63f82c3a59f9-150x150.jpeg","live":1,"viewers":8,"embed_viewers":1,"embed_enabled":1,"featured":0,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-28T15:51:10.000Z","updated_at":"2012-01-28T15:51:10.000Z"},{"id":44,"channel":"palendrome69","title":"Palendrome69","live_title":"Hon with LeHeup80 (complete newubie)","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_palendrome69-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/palendrome69-profile_image-fabcf609e967f3d1-150x150.png","live":1,"viewers":3,"embed_viewers":0,"embed_enabled":1,"featured":0,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-28T15:51:10.000Z","updated_at":"2012-01-28T15:51:10.000Z"},{"id":45,"channel":"cake4real","title":"cake4real","live_title":null,"screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_cake4real-70x53.jpg","channel_image_medium":"http://www-cdn.jtvnw.net/images/redesign/404_user_150x150.png","live":1,"viewers":2,"embed_viewers":0,"embed_enabled":1,"featured":0,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-28T15:51:10.000Z","updated_at":"2012-01-28T15:51:10.000Z"},{"id":46,"channel":"nightzhade","title":"nightzhade","live_title":"1700+ big playus","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_nightzhade-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/nightzhade-profile_image-1700a5577da284dc-150x150.jpeg","live":1,"viewers":1,"embed_viewers":0,"embed_enabled":0,"featured":0,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-28T15:51:10.000Z","updated_at":"2012-01-28T15:51:10.000Z"},{"id":47,"channel":"nikolo8d","title":"Nikolo8D","live_title":"Elvis Plays HoN!!! - æøå! (Denmark)","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_nikolo8d-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/nikolo8d-profile_image-c35882d10c8194ef-150x150.jpeg","live":1,"viewers":1,"embed_viewers":0,"embed_enabled":1,"featured":0,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-28T15:51:10.000Z","updated_at":"2012-01-28T15:51:10.000Z"},{"id":48,"channel":"xiaojay","title":"Garena Heroes Of Newerth","live_title":"Garena Heroes Of Newerth","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_xiaojay-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/xiaojay-profile_image-7da9a2de4ce942dc-150x150.png","live":1,"viewers":2,"embed_viewers":0,"embed_enabled":1,"featured":0,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-28T15:51:10.000Z","updated_at":"2012-01-28T15:51:10.000Z"},{"id":49,"channel":"daxt86","title":"daxt86","live_title":"Streaming HoN mostly. Used to be 1950ish mmr / decent high comp level. Going to be streaming GW2 as well after it launches.","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_daxt86-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/daxt86-profile_image-16cfb4c3f4ff276e-150x150.jpeg","live":1,"viewers":0,"embed_viewers":0,"embed_enabled":1,"featured":0,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-28T15:51:10.000Z","updated_at":"2012-01-28T15:51:10.000Z"},{"id":50,"channel":"y0ru","title":"y0ru","live_title":"[720p] me sucking at hon","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_y0ru-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/y0ru-profile_image-103cb45a51a1ae40-150x150.jpeg","live":1,"viewers":0,"embed_viewers":0,"embed_enabled":1,"featured":0,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-28T15:51:10.000Z","updated_at":"2012-01-28T15:51:10.000Z"},{"id":51,"channel":"tonylanglet","title":"Tony Langlet @ Core-portal.com","live_title":"Scarboni - HoN Playing solo with randoms","screen_cap_small":"http://static-cdn.jtvnw.net/previews/live_user_tonylanglet-70x53.jpg","channel_image_medium":"http://static-cdn.jtvnw.net/jtv_user_pictures/tonylanglet-profile_image-0930742bf7b4e323-150x150.jpeg","live":1,"viewers":0,"embed_viewers":0,"embed_enabled":1,"featured":0,"delayed":0,"live_at":"2012-01-28T15:51:09.000Z","created_at":"2012-01-28T15:51:10.000Z","updated_at":"2012-01-28T15:51:10.000Z"}];

testdata.sort (a, b)->
	return -1 if a.viewers > b.viewers
	return 1

self.init = (selector)->
	$ ->
		# Set class to honsapp
		self.el = $(selector).addClass 'honsapp'

		# Add the sidebar
		sidebar = Sidebar.create()

		self.el.append sidebar.el

		setTimeout ->
			sidebar.setStreams testdata
		, 1000

		#dataloader.fetchLiveStreams (streams)->
		#	sidebar.setStreams streams

		# Add the display
		display = Display.create()
		self.el.append display.el
